// ========== FILTRER LES LIGNES DU TABLEAU + COLONNES SELON GENRE ==========

var rows = document.querySelectorAll('.table-container tbody tr');
var visibleCount = 0;

// ðŸ”¥ RÃ©cupÃ©rer l'en-tÃªte pour masquer/afficher les colonnes
var tableHeaders = document.querySelectorAll('.table-container thead th');

console.log('ðŸŽ¯ Filtrage tableau avec genre:', filterGenre);

for (var i = 0; i < rows.length; i++) {
    var row = rows[i];
    
    // Ignorer la ligne "Aucune statistique"
    if (row.querySelector('.empty-state')) continue;
    
    var rowRegion = row.getAttribute('data-region');
    var rowPrefecture = row.getAttribute('data-prefecture');
    var rowZone = row.getAttribute('data-zone');
    var rowNiveau = row.getAttribute('data-niveau');
    
    var showRow = true;
    
    // Trouver l'ID de la rÃ©gion
    var rowRegionId = '';
    for (var r = 0; r < regionsData.length; r++) {
        if (regionsData[r].nom === rowRegion) {
            rowRegionId = regionsData[r].id;
            break;
        }
    }
    
    if (filterRegion && rowRegionId != filterRegion) showRow = false;
    if (filterPrefecture && rowPrefecture != filterPrefecture) showRow = false;
    if (filterZone && rowZone != filterZone) showRow = false;
    
    // Gestion CollÃ¨ge/LycÃ©e
    if (filterNiveau) {
        if (filterNiveau === 'CollÃ¨ge' || filterNiveau === 'LycÃ©e') {
            if (rowNiveau !== 'Secondaire') showRow = false;
        } else {
            if (rowNiveau != filterNiveau) showRow = false;
        }
    }
    
    // ðŸ”¥ MASQUER/AFFICHER LES COLONNES SELON LE GENRE
    var cells = row.querySelectorAll('td');
    
    if (filterGenre === 'Filles') {
        // Masquer GarÃ§ons (G) et Total (T)
        // Colonnes : RÃ©gion(0), PrÃ©f(1), Zone(2), Niveau(3), Badge(4)
        // Scol: F(5), G(6), T(7) | Aban: F(8), G(9), T(10)
        // RÃ©ussite CEE(11), BEPC(12), BAC(13) | Alpha(14), RatioEns(15), RatioCl(16), Dist(17)
        
        if (cells.length >= 18) {
            cells[6].style.display = 'none';  // Scol G
            cells[7].style.display = 'none';  // Scol T
            cells[9].style.display = 'none';  // Aban G
            cells[10].style.display = 'none'; // Aban T
        }
    } else if (filterGenre === 'Garcons') {
        // Masquer Filles (F) et Total (T)
        if (cells.length >= 18) {
            cells[5].style.display = 'none';  // Scol F
            cells[7].style.display = 'none';  // Scol T
            cells[8].style.display = 'none';  // Aban F
            cells[10].style.display = 'none'; // Aban T
        }
    } else if (filterGenre === 'Total') {
        // Masquer Filles (F) et GarÃ§ons (G)
        if (cells.length >= 18) {
            cells[5].style.display = 'none';  // Scol F
            cells[6].style.display = 'none';  // Scol G
            cells[8].style.display = 'none';  // Aban F
            cells[9].style.display = 'none';  // Aban G
        }
    } else {
        // Afficher toutes les colonnes
        for (var c = 0; c < cells.length; c++) {
            cells[c].style.display = '';
        }
    }
    
    row.style.display = showRow ? '' : 'none';
    if (showRow) visibleCount++;
}

// ðŸ”¥ MASQUER/AFFICHER LES EN-TÃŠTES AUSSI
if (tableHeaders.length >= 18) {
    if (filterGenre === 'Filles') {
        tableHeaders[6].style.display = 'none';  // Scol. G (%)
        tableHeaders[7].style.display = 'none';  // Scol. T (%)
        tableHeaders[9].style.display = 'none';  // Aban. G (%)
        tableHeaders[10].style.display = 'none'; // Aban. T (%)
    } else if (filterGenre === 'Garcons') {
        tableHeaders[5].style.display = 'none';  // Scol. F (%)
        tableHeaders[7].style.display = 'none';  // Scol. T (%)
        tableHeaders[8].style.display = 'none';  // Aban. F (%)
        tableHeaders[10].style.display = 'none'; // Aban. T (%)
    } else if (filterGenre === 'Total') {
        tableHeaders[5].style.display = 'none';  // Scol. F (%)
        tableHeaders[6].style.display = 'none';  // Scol. G (%)
        tableHeaders[8].style.display = 'none';  // Aban. F (%)
        tableHeaders[9].style.display = 'none';  // Aban. G (%)
    } else {
        // Afficher tous les en-tÃªtes
        for (var h = 0; h < tableHeaders.length; h++) {
            tableHeaders[h].style.display = '';
        }
    }
}

console.log('ðŸ“Š Lignes visibles dans le tableau:', visibleCount);
